<div *ngIf="isLoading" class="fullscreen-loader">
  <div class="spinner-border text-primary" role="status">
    <span class="visually-hidden">Loading...</span>
  </div>
</div>

<div class="container mt-3">
  <div class="card shadow p-4">
    <div class="text-center mb-4">
      <i class="fas fa-layer-group fa-3x text-primary"></i>
      <h4 class="mt-2">Add New Group</h4>
    </div>

    <form [formGroup]="groupForm" (ngSubmit)="onSubmit()">
      <div class="row">
        <!-- Group Name -->
        <div class="col-md-6 mb-3">
          <label>Group Name</label>
          <input class="form-control" formControlName="name" />
          <div class="text-danger" *ngIf="f['name'].touched && f['name'].invalid">
            <small *ngIf="f['name'].errors?.['required']">Group name is required.</small>
            <small *ngIf="f['name'].errors?.['minlength']">Minimum 4 characters required.</small>
          </div>
        </div>

        <!-- Course -->
        <div class="col-md-6 mb-3">
          <label>Course</label>
          <select class="form-control" formControlName="courseId" >
            <option value="">Select Course</option>
            <option *ngFor="let course of courses" [value]="course.courseId">{{ course.name }}</option>
          </select>
          <div class="text-danger" *ngIf="f['courseId'].touched && f['courseId'].invalid">
            Course is required.
          </div>
        </div>

        <!-- Level Description (ReadOnly) -->
        <div class="col-md-6 mb-3">
          <label>Level Description</label>
          <input class="form-control" formControlName="levelDescription" readonly />
          <div class="text-danger" *ngIf="f['levelDescription'].touched && f['levelDescription'].invalid">
            Level description is required.
          </div>
        </div>

        <!-- Instructor -->
        <div class="col-md-6 mb-3">
          <label>Instructor</label>
          <select class="form-control" formControlName="teacherId">
            <option value="">Select Instructor</option>
            <option *ngFor="let teacher of instructors" [value]="teacher.userId">{{ teacher.name }}</option>
          </select>
          <div class="text-danger" *ngIf="f['teacherId'].touched && f['teacherId'].invalid">
            Instructor is required.
          </div>
        </div>

        <!-- Amount -->
        <div class="col-md-6 mb-3">
          <label>Amount</label>
          <input type="number" class="form-control" formControlName="amount" />
          <div class="text-danger" *ngIf="f['amount'].touched && f['amount'].invalid">
            <small *ngIf="f['amount'].errors?.['required']">Amount is required.</small>
            <small *ngIf="f['amount'].errors?.['min']">Amount must be greater than 0.</small>
          </div>
        </div>

        <!-- Dates -->
        <div class="col-md-6 mb-3">
          <label>Start Date</label>
          <input type="date" class="form-control" formControlName="levelStartDate" />
          <div class="text-danger" *ngIf="f['levelStartDate'].touched && f['levelStartDate'].invalid">
            Start date is required.
          </div>
        </div>

        <div class="col-md-6 mb-3">
          <label>End Date</label>
          <input type="date" class="form-control" formControlName="levelEndDate" />
          <div class="text-danger" *ngIf="f['levelEndDate'].touched && f['levelEndDate'].invalid">
            End date is required.
          </div>
        </div>

        <div class="col-md-6 mb-3">
          <label>Next Payment Date</label>
          <input type="date" class="form-control" formControlName="nextPaymentDate" />
          <div class="text-danger" *ngIf="f['nextPaymentDate'].touched && f['nextPaymentDate'].invalid">
            Next payment date is required.
          </div>
        </div>
      </div>

      <div class="d-flex justify-content-center gap-3 mt-4">
        <button type="submit" class="btn btn-primary" [disabled]="groupForm.invalid">
          <i class="fas fa-save me-1"></i> Save Group
        </button>
        <a routerLink="/admin/getgroup" class="btn btn-outline-secondary">
          <i class="fas fa-list me-1"></i> All Groups
        </a>
      </div>
    </form>
  </div>
</div>
